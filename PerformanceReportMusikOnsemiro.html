<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´ì§€í¬ ì˜¨ìƒˆë¯¸ë¡œ ì—°ì£¼ ë³´ê³ ì„œ</title>

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        :root {
            --primary-color: #7c3aed;
            --bg-color: #f1f5f9;
        }

        body {
            background-color: var(--bg-color);
            font-family: 'Noto Sans KR', sans-serif;
            color: #334155;
            -webkit-print-color-adjust: exact;
        }

        /* ----------------------------------------------------
           1. ì—ë””í„° íŒ¨ë„ (ì™¼ìª½)
           ---------------------------------------------------- */
        .editor-container {
            height: 100vh;
            overflow-y: auto;
            background: white;
            border-right: 1px solid #e2e8f0;
            padding: 2rem;
            z-index: 10;
        }

        .section-header {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 5px;
        }

        .calc-box {
            background: #fff1f2;
            border: 1px solid #fecdd3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        /* ----------------------------------------------------
           2. ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ (ì˜¤ë¥¸ìª½) - ìŠ¤í¬ë¡¤ ê°œì„ 
           ---------------------------------------------------- */
        .preview-container {
            background-color: #64748b;
            padding: 50px 20px;
            /* ìœ„ì•„ë˜ ì—¬ë°± í™•ë³´ */
            height: 100vh;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            /* ğŸŒŸ í•µì‹¬ ìˆ˜ì •: ë‚´ìš©ì´ ê¸¸ì–´ì§€ë©´ ì•„ë˜ë¡œ ëŠ˜ì–´ë‚˜ê²Œ í•¨ */
        }

        .paper {
            background: white;
            width: 210mm;
            min-height: 297mm;
            height: auto;
            /* ë‚´ìš©ì— ë”°ë¼ ëŠ˜ì–´ë‚¨ */
            padding: 20mm;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
            position: relative;
            margin-bottom: 50px;
            /* ìŠ¤í¬ë¡¤ ëë¶€ë¶„ ì—¬ë°± */
        }

        /* ----------------------------------------------------
           3. ë³´ê³ ì„œ ë‚´ë¶€ ìš”ì†Œ ìŠ¤íƒ€ì¼
           ---------------------------------------------------- */
        h1.report-title {
            font-size: 24pt;
            font-weight: 800;
            text-align: center;
            margin-bottom: 50px;
            /* ê²°ì¬ë€ ì‚­ì œë¡œ ì¸í•œ ì—¬ë°± ì¡°ì • */
            color: #000;
        }

        table.report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 10.5pt;
            page-break-inside: auto;
        }

        table.report-table th,
        table.report-table td {
            border: 1px solid #000;
            padding: 8px 10px;
        }

        table.report-table th {
            background-color: #f1f5f9;
            text-align: center;
            font-weight: 600;
            width: 18%;
        }

        tr {
            page-break-inside: avoid;
            page-break-after: auto;
        }

        .report-section-title {
            font-size: 13pt;
            font-weight: 700;
            border-left: 6px solid #000;
            padding-left: 12px;
            margin: 30px 0 15px 0;
            background: #f8fafc;
            padding-top: 5px;
            padding-bottom: 5px;
            page-break-after: avoid;
        }

        .content-text {
            white-space: pre-wrap;
            font-size: 11pt;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .evidence-img-wrapper {
            text-align: center;
            margin-bottom: 20px;
            page-break-inside: avoid;
        }

        .evidence-img {
            max-width: 100%;
            max-height: 500px;
            border: 1px solid #ddd;
        }

        /* ----------------------------------------------------
           4. ì¸ì‡„ ëª¨ë“œ (Print CSS)
           ---------------------------------------------------- */
        @media print {

            .editor-container,
            .btn,
            ::-webkit-scrollbar {
                display: none !important;
            }

            .preview-container {
                padding: 0;
                height: auto;
                background: white;
                display: block;
                overflow: visible;
            }

            .paper {
                box-shadow: none;
                margin: 0;
                width: 100%;
                max-width: 100%;
                padding: 0;
                height: auto;
                margin-bottom: 0;
            }

            @page {
                size: A4;
                margin: 15mm 15mm;
            }
        }
    </style>
</head>

<body>

    <div class="container-fluid p-0">
        <div class="row g-0">

            <div class="col-md-4 editor-container">
                <h4 class="fw-bold mb-4 text-primary"><i class="bi bi-file-earmark-music"></i> ë¬´ì§€í¬ ì˜¨ìƒˆë¯¸ë¡œ ì—°ì£¼ë³´ê³ ì„œ</h4>

                <div class="section-header">1. ê¸°ë³¸ ì •ë³´</div>
                <div class="mb-2"><label class="form-label">ì—°ì£¼ ì œëª©</label><input type="text" id="inTitle"
                        class="form-control" placeholder="ì œ 10íšŒ ì •ê¸°ì—°ì£¼íšŒ" oninput="updateView()"></div>

                <div class="row mb-2">
                    <div class="col-6"><label class="form-label">ì¼ì</label><input type="date" id="inDate"
                            class="form-control" oninput="updateView()"></div>

                    <div class="col-6">
                        <label class="form-label">ì‹œê°„ (ì‹œì‘ ~ ì¢…ë£Œ)</label>
                        <div class="d-flex align-items-center gap-2">
                            <input type="time" id="inStartTime" class="form-control" oninput="updateView()">
                            <span>~</span>
                            <input type="time" id="inEndTime" class="form-control" oninput="updateView()">
                        </div>
                    </div>
                </div>

                <div class="mb-2"><label class="form-label">ì¥ì†Œ</label><input type="text" id="inPlace"
                        class="form-control" oninput="updateView()"></div>
                <div class="row mb-2">
                    <div class="col-6"><label class="form-label">ì£¼ìµœ/ì£¼ê´€</label><input type="text" id="inHost"
                            class="form-control" oninput="updateView()"></div>
                    <div class="col-6">
                        <label class="form-label">ìœ í˜•</label>
                        <select id="inType" class="form-select" onchange="updateView()">
                            <option value="ëŒ€ìŒì•…íšŒ (1ì‹œê°„ ì´ìƒ)">ëŒ€ìŒì•…íšŒ (1ì‹œê°„ ì´ìƒ)</option>
                            <option value="ë¯¸ë‹ˆìŒì•…íšŒ(30~40ë¶„ì •ë„)">ë¯¸ë‹ˆìŒì•…íšŒ(30~40ë¶„ì •ë„)</option>
                            <option value="ì´ˆì²­ê³µì—°(1,2ê³¡)">ì´ˆì²­ê³µì—°(1,2ê³¡)</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2"><label class="form-label">ëŒ€ìƒ ì²­ì¤‘</label><input type="text" id="inAudience"
                        class="form-control" oninput="updateView()"></div>

                <div class="section-header">2. ì°¸ì—¬ì ì •ë³´</div>
                <div class="row mb-2">
                    <div class="col-6"><label class="form-label">ì—°ì£¼ì(ë³¸ì¸)</label><input type="text" id="inPerformer"
                            class="form-control" oninput="updateView()"></div>
                    <div class="col-6"><label class="form-label">ì•…ê¸°/íŒŒíŠ¸</label><input type="text" id="inInstrument"
                            class="form-control" oninput="updateView()"></div>
                </div>
                <div class="mb-2"><label class="form-label">ê³µë™ ì—°ì£¼ì</label><textarea id="inPartners" class="form-control"
                        rows="2" placeholder="ì˜ˆ: í™ê¸¸ë™(í”¼ì•„ë…¸), ê¹€ì² ìˆ˜(ë°”ì´ì˜¬ë¦°)" oninput="updateView()"></textarea></div>
                <div class="mb-2"><label class="form-label">íŠ¹ë³„ì¶œì—°/ì§€íœ˜</label><input type="text" id="inSpecial"
                        class="form-control" oninput="updateView()"></div>

                <div class="section-header">3. í”„ë¡œê·¸ë¨</div>
                <div class="mb-2"><textarea id="inProgram" class="form-control" rows="4" placeholder="ê³¡ëª… ì…ë ¥"
                        oninput="updateView()"></textarea></div>
                <div class="mb-2">
                    <label class="form-label text-danger small">â€» [ì¦ë¹™ìë£Œ ì—…ë¡œë“œ] 1. í”„ë¡œê·¸ë¨ë¶ í‘œì§€</label>
                    <input type="file" class="form-control" accept="image/*"
                        onchange="loadImage(this, 'viewProgramImg')">
                </div>

                <div class="section-header">4. êµí†µë¹„ (ì™•ë³µ/í•˜ì´íŒ¨ìŠ¤)</div>
                <select id="transportMode" class="form-select mb-3" onchange="toggleTransportMode()">
                    <option value="car">ìì°¨ (ê³µì‹ ê³„ì‚°)</option>
                    <option value="train">ê¸°ì°¨/í•­ê³µ (ì‹¤ë¹„)</option>
                    <option value="carpool">ì¹´í’€ (ì§€ê¸‰ ì œì™¸)</option>
                </select>

                <div id="modeCar" class="calc-box">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="isRoundTrip" onchange="calcTransport()"
                            checked>
                        <label class="form-check-label fw-bold text-danger" for="isRoundTrip">ì™•ë³µ ì ìš© (x2)</label>
                    </div>
                    <div class="row g-2 mb-2">
                        <div class="col-6"><label class="small">í¸ë„ ê±°ë¦¬(km)</label><input type="number" id="tDist"
                                class="form-control" placeholder="0" oninput="calcTransport()"></div>
                        <div class="col-6"><label class="small">ìœ ê°€(ì›/L)</label><input type="number" id="tPrice"
                                class="form-control" placeholder="1650" oninput="calcTransport()"></div>
                    </div>
                    <div class="mb-2"><label class="small">í¸ë„ í†µí–‰ë£Œ(í•˜ì´íŒ¨ìŠ¤)</label><input type="number" id="tToll"
                            class="form-control" placeholder="0" oninput="calcTransport()"></div>
                    <div class="mb-2"><label class="small">ì§€ì—­</label><input type="text" id="tRegion"
                            class="form-control form-control-sm" placeholder="ì„œìš¸ ì„œì´ˆêµ¬" oninput="updateView()"></div>
                </div>

                <div id="modePublic" class="calc-box d-none">
                    <label>ì‹¤ ê²°ì œ ê¸ˆì•¡ (ì›)</label><input type="number" id="tActualCost" class="form-control"
                        oninput="calcTransport()">
                </div>

                <div class="d-flex justify-content-between mb-2">
                    <strong class="small">ì²­êµ¬ì•¡:</strong>
                    <strong id="finalCostDisplay" class="text-primary">0 ì›</strong>
                </div>
                <div class="mb-2">
                    <label class="form-label text-danger small">â€» [ì¦ë¹™] 1.ì§€ë„ì¦ë¹™, 2. í•˜ì´íŒ¨ìŠ¤ì˜ìˆ˜ì¦, 3. ìœ ë¥˜ë¹„ì¦ë¹™(https://www.opinet.co.kr/user/dopospdrg/dopOsPdrgAreaView.do)</label>
                    <input type="file" class="form-control" accept="image/*"
                        onchange="loadImage(this, 'viewTransportImg')">
                </div>

                <div class="section-header">5. ì´í‰ & ì²¨ë¶€</div>
                <textarea id="inComment" class="form-control mb-3" rows="3" placeholder="ì—°ì£¼ ì´í‰"
                    oninput="updateView()"></textarea>

                <label class="form-label small">ì¶”ê°€ í˜„ì¥ ì‚¬ì§„ (ë‹¤ì¤‘ ì„ íƒ)</label>
                <input type="file" class="form-control" accept="image/*" multiple onchange="handleAppendixImages(this)">

                <hr class="my-4">
                <button class="btn btn-primary w-100 py-3 fw-bold fs-5 shadow-sm" onclick="window.print()">
                    <i class="bi bi-printer-fill me-2"></i> PDF ì¸ì‡„ / ì €ì¥
                </button>
            </div>

            <div class="col-md-8 preview-container">
                <div class="paper print-area">

                    <h1 class="report-title">ë¬´ ì§€ í¬ ì˜¨ ìƒˆ ë¯¸ ë¡œ <br> ì—° ì£¼ ë³´ ê³  ì„œ</h1>

                    <div class="report-section-title">1. ê³µì—° ê°œìš”</div>
                    <table class="report-table">
                        <tr>
                            <th>ê³µì—°ëª…</th>
                            <td colspan="3" id="outTitle"></td>
                        </tr>
                        <tr>
                            <th>ì¼ ì‹œ</th>
                            <td id="outDate"></td>
                            <th>ì‹œ ê°„</th>
                            <td id="outTime"></td>
                        </tr>
                        <tr>
                            <th>ì¥ ì†Œ</th>
                            <td id="outPlace"></td>
                            <th>ìœ  í˜•</th>
                            <td id="outType"></td>
                        </tr>
                        <tr>
                            <th>ì£¼ìµœ/ì£¼ê´€</th>
                            <td id="outHost"></td>
                            <th>ëŒ€ ìƒ</th>
                            <td id="outAudience"></td>
                        </tr>
                    </table>

                    <div class="report-section-title">2. ì°¸ì—¬ì</div>
                    <table class="report-table">
                        <tr>
                            <th>ì—°ì£¼ì</th>
                            <td id="outPerformer"></td>
                            <th>ì•…ê¸°/íŒŒíŠ¸</th>
                            <td id="outInstrument"></td>
                        </tr>
                        <tr>
                            <th>ê³µë™ì—°ì£¼</th>
                            <td colspan="3" id="outPartners"></td>
                        </tr>
                        <tr>
                            <th>íŠ¹ë³„ì°¸ì—¬</th>
                            <td colspan="3" id="outSpecial"></td>
                        </tr>
                    </table>

                    <div class="report-section-title">3. í”„ë¡œê·¸ë¨ êµ¬ì„±</div>
                    <div id="outProgram" class="content-text border p-2 mb-2"></div>
                    <div id="viewProgramImgArea" class="evidence-img-wrapper d-none">
                        <img id="viewProgramImg" class="evidence-img" src="">
                        <p class="small text-muted mt-1">- í”„ë¡œê·¸ë¨ ë¶ -</p>
                    </div>

                    <div class="report-section-title">4. êµí†µë¹„ ì‚°ì¶œ ë‚´ì—­</div>
                    <table class="report-table">
                        <tr>
                            <th>ì´ë™ìˆ˜ë‹¨</th>
                            <td id="outTransportMode">ìì°¨</td>
                            <th>ì²­êµ¬ê¸ˆì•¡</th>
                            <td id="outTransportCost" class="fw-bold text-end pe-3">0 ì›</td>
                        </tr>
                        <tr>
                            <th>ì‚°ì¶œê·¼ê±°</th>
                            <td colspan="3" id="outTransportDetail" class="small"></td>
                        </tr>
                    </table>
                    <div id="viewTransportImgArea" class="evidence-img-wrapper d-none">
                        <img id="viewTransportImg" class="evidence-img" src="">
                        <p class="small text-muted mt-1">- ì˜ìˆ˜ì¦/ê²½ë¡œ ì¦ë¹™ -</p>
                    </div>

                    <div class="report-section-title">5. ì—°ì£¼ ì´í‰</div>
                    <div id="outComment" class="content-text border p-3"></div>

                    <div id="appendixSection" class="d-none">
                        <div class="report-section-title">6. ì²¨ë¶€ ìë£Œ (Appendix)</div>
                        <div id="appendixImages"></div>
                    </div>

                    <div class="text-center mt-5 pt-4">
                        <p>ìœ„ì™€ ê°™ì´ ì—°ì£¼ ê²°ê³¼ë¥¼ ë³´ê³ í•©ë‹ˆë‹¤.</p>
                        <p class="mt-4" id="signDate"></p>
                        <p class="fw-bold mt-4" style="font-size: 14pt;">ì‘ì„±ì: <span id="signerName"></span> (ì¸)</p>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function () {
            const today = new Date();
            document.getElementById('inDate').valueAsDate = today;
            document.getElementById('signDate').innerText = today.toLocaleDateString() + " " + "ì‘ì„±";
            updateView();
        };

        function updateView() {
            const mapping = {
                'inTitle': 'outTitle', 'inPlace': 'outPlace', 'inHost': 'outHost', 'inType': 'outType',
                'inAudience': 'outAudience', 'inPerformer': 'outPerformer', 'inInstrument': 'outInstrument',
                'inPartners': 'outPartners', 'inSpecial': 'outSpecial', 'inProgram': 'outProgram',
                'inComment': 'outComment'
            };

            for (let inputId in mapping) {
                document.getElementById(mapping[inputId]).innerText = document.getElementById(inputId).value;
            }

            const date = document.getElementById('inDate').value;
            document.getElementById('outDate').innerText = date;
            document.getElementById('signDate').innerText = date + " ì‘ì„±";
            document.getElementById('signerName').innerText = document.getElementById('inPerformer').value;

            // ì‹œê°„ ì²˜ë¦¬
            const startTime = document.getElementById('inStartTime').value;
            const endTime = document.getElementById('inEndTime').value;
            let timeStr = "";
            if (startTime && endTime) {
                timeStr = startTime + " ~ " + endTime;
            } else if (startTime) {
                timeStr = startTime + " ~ ";
            }
            document.getElementById('outTime').innerText = timeStr;

            calcTransport();
        }

        function toggleTransportMode() {
            const mode = document.getElementById('transportMode').value;
            const carBox = document.getElementById('modeCar');
            const pubBox = document.getElementById('modePublic');

            if (mode === 'car') {
                carBox.classList.remove('d-none');
                pubBox.classList.add('d-none');
                document.getElementById('outTransportMode').innerText = "ìì°¨ (ë²•ì¸/ê°œì¸)";
            } else if (mode === 'train') {
                carBox.classList.add('d-none');
                pubBox.classList.remove('d-none');
                document.getElementById('outTransportMode').innerText = "ëŒ€ì¤‘êµí†µ (ê¸°ì°¨/í•­ê³µ)";
            } else {
                carBox.classList.add('d-none');
                pubBox.classList.add('d-none');
                document.getElementById('outTransportMode').innerText = "ì¹´í’€/ê¸°íƒ€";
            }
            calcTransport();
        }

        function calcTransport() {
            const mode = document.getElementById('transportMode').value;
            let cost = 0;
            let detailText = "";

            if (mode === 'car') {
                const dist = parseFloat(document.getElementById('tDist').value) || 0;
                const price = parseFloat(document.getElementById('tPrice').value) || 0;
                const toll = parseFloat(document.getElementById('tToll').value) || 0;
                const isRoundTrip = document.getElementById('isRoundTrip').checked;
                const region = document.getElementById('tRegion').value || "ì§€ì—­ë¯¸ì •";

                let oneWayTotal = ((dist / 11) * price) + toll;

                if (isRoundTrip) {
                    cost = Math.round(oneWayTotal * 2);
                    detailText = `[ì™•ë³µ] {(í¸ë„ ${dist}km Ã· 11 Ã— ${price}ì›) + í†¨ë¹„ ${toll.toLocaleString()}ì›} Ã— 2íšŒ`;
                } else {
                    cost = Math.round(oneWayTotal);
                    detailText = `[í¸ë„] (ê±°ë¦¬ ${dist}km Ã· 11 Ã— ${price}ì›) + í†¨ë¹„ ${toll.toLocaleString()}ì›`;
                }
                detailText += ` / ${region} ê¸°ì¤€`;

            } else if (mode === 'train') {
                cost = parseFloat(document.getElementById('tActualCost').value) || 0;
                detailText = "ì‹¤ë¹„ ì •ì‚° (ì˜ìˆ˜ì¦ ê¸ˆì•¡ ê¸°ì¤€)";
            } else {
                cost = 0;
                detailText = "êµí†µë¹„ ì§€ê¸‰ ëŒ€ìƒ ì•„ë‹˜";
            }

            const formattedCost = cost.toLocaleString() + " ì›";
            document.getElementById('finalCostDisplay').innerText = formattedCost;
            document.getElementById('outTransportCost').innerText = formattedCost;
            document.getElementById('outTransportDetail').innerText = detailText;
        }

        function loadImage(input, targetId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.getElementById(targetId);
                    img.src = e.target.result;
                    img.parentElement.classList.remove('d-none');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function handleAppendixImages(input) {
            const container = document.getElementById('appendixImages');
            const section = document.getElementById('appendixSection');

            container.innerHTML = '';

            if (input.files && input.files.length > 0) {
                section.classList.remove('d-none');
                Array.from(input.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'evidence-img-wrapper';

                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'evidence-img';

                        wrapper.appendChild(img);
                        container.appendChild(wrapper);
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                section.classList.add('d-none');
            }
        }
    </script>

</body>

</html>
